FROM jenkins/jenkins:lts-jdk17

USER root

# ğŸ§© é€‚é… Debian 13 (trixie) + è®¾ç½®å›½å†… apt æº (USTC) + Python + pip å›½å†…æº
RUN set -eux; \
    # åˆ‡æ¢åˆ°ä¸­ç§‘å¤§æºï¼ˆæ”¯æŒ Debian 13ï¼‰
    if [ -f /etc/apt/sources.list ]; then \
        sed -i 's@deb.debian.org@mirrors.ustc.edu.cn@g; s@security.debian.org@mirrors.ustc.edu.cn@g' /etc/apt/sources.list; \
    elif [ -f /etc/apt/sources.list.d/debian.sources ]; then \
        sed -i -E 's|URIs: .*debian|URIs: http://mirrors.ustc.edu.cn/debian|g' /etc/apt/sources.list.d/debian.sources; \
    fi; \
    apt-get clean; \
    apt-get update; \
    # å®‰è£… Python3 + pip3 + curl
    apt-get install -y --no-install-recommends python3 python3-pip curl; \
    # é…ç½® pip å›½å†…æº
    pip3 config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple; \
    # ç›´æ¥å®‰è£…æµ‹è¯•ä¾èµ–ï¼Œä¸å‡çº§ pipï¼ˆä¿®å¤ uninstall-no-record-fileï¼‰
    pip3 install pytest requests allure-pytest pyyaml pytest-dependency pytest-base-url pytest-html pytest-metadata --break-system-packages; \
    apt-get clean; \
    rm -rf /var/lib/apt/lists/*


# ä¿æŒ Jenkins å¯åŠ¨å‘½ä»¤
CMD ["/usr/bin/tini", "--", "/usr/local/bin/jenkins.sh"]



